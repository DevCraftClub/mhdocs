# MhDB

## Свойства класса

### `config`
**Тип:** ``  
**Описание:** Класс для работы с базой данных @since 171.3.0 / class MhDB { private ?ORM\ORM               $orm         = null; private ?DatabaseManager       $orm_manager = null; private ?Config\DatabaseConfig $orm_config  = null; private ?ORM\EntityManager     $em          = null; private bool                   $user_db     = false; public function __construct(bool $user_db = false) { $this->user_db = $user_db; $this->generateOrm(); $this->setManager(); } / Создает и возвращает экземпляр ORM (Object-Relational Mapper), используя предварительно скомпилированную схему, фабрику ORM, менеджер базы данных, а также генератор команд с поддержкой событий. Если ORM уже инициализирован, то возвращает ранее созданный объект. Генерация ORM основывается на схеме, созданной методом {@see compileSchema()}, которой, в свою очередь, необходим зарегистрированный реестр сущностей. Управление базой данных осуществляется через метод {@see generateManager()}. @return ORM\ORM Объект ORM (Object-Relational Mapper), предназначенный для взаимодействия с базой данных. @throws RuntimeException Если генерация схемы или конфигурации базы данных завершилась с ошибкой. / private function generateOrm(): ORM\ORM { if (is_null($this->orm)) { $registry = new Registry($this->generateManager()); [$schemaArray, $migrator] = $this->compileSchema($registry); $schema           = new Cycle\ORM\Schema($schemaArray); $factory          = new ORM\Factory($this->generateManager()); $container        = new Container(); $commandGenerator = new EventDrivenCommandGenerator($schema, $container); $this->orm = new ORM\ORM( factory         : $factory, schema          : $schema, commandGenerator: $commandGenerator ); $migrator->run(new Capsule($this->generateManager()->database())); } return $this->orm; } / Создает и возвращает экземпляр класса DatabaseManager. Если объект `orm_manager` еще не создан, метод инициирует новый объект `DatabaseManager` на основе конфигурации ORM, полученной из метода `generateOrmConfig`. @see generateOrmConfig() Используется для получения необходимой ORM-конфигурации. @return DatabaseManager Экземпляр менеджера базы данных, конфигурированного с помощью ORM. @throws RuntimeException Генерируется, если не удается подключить необходимый файл конфигурации базы данных. @throws \ConfigException Генерируется, если конфигурация базы данных содержит ошибки. / private function generateManager(): DatabaseManager { return $this->orm_manager ??= new DatabaseManager($this->generateOrmConfig()); } / Генерирует и возвращает объект конфигурации базы данных ORM, если он ещё не создан. Функция проверяет, был ли ранее инициализирован объект конфигурации ORM. Если объект отсутствует, производится его создание на основании глобальных настроек. Подключается файл конфигурации базы данных и выполняется подготовка данных, таких как разбиение хоста и порта, а также выборка префикса таблиц в зависимости от типа базы данных. @return Config\DatabaseConfig Объект конфигурации базы данных ORM. @global array $config Глобальный массив настроек приложения, содержащий данные конфигурации.

## Методы

### `generateOrm` {#метод-generateOrm}
**Модификатор:** private function generateOrm(

### `generateManager` {#метод-generateManager}
**Модификатор:** private function generateManager(

### `generateOrmConfig` {#метод-generateOrmConfig}
**Модификатор:** private function generateOrmConfig(

### `compileSchema` {#метод-compileSchema}
**Модификатор:** private function compileSchema(

### `setManager` {#метод-setManager}
**Модификатор:** public function setManager(

### `delete` {#метод-delete}
**Модификатор:** public function delete(

### `get` {#метод-get}
**Модификатор:** public function get(

### `getAll` {#метод-getAll}
**Модификатор:** public function getAll(

### `repository` {#метод-repository}
**Модификатор:** public function repository(

### `getOrm` {#метод-getOrm}
**Модификатор:** public function getOrm(

### `run` {#метод-run}
**Модификатор:** public function run(

### `create` {#метод-create}
**Модификатор:** public function create(

### `update` {#метод-update}
**Модификатор:** public function update(

### `query` {#метод-query}
**Модификатор:** public function query(

### `paginate` {#метод-paginate}
**Модификатор:** public function paginate(

### `count` {#метод-count}
**Модификатор:** public function count(

## Функция: `MhDB`

**Описание:**  
Класс для работы с базой данных

**Возвращаемый тип:** `int` - Количество записей в репозитории, связанных с данной сущностью.

**Теги:**
## Функция: `generateOrm`

**Описание:**  
Создает и возвращает экземпляр ORM (Object-Relational Mapper), используя
предварительно скомпилированную схему, фабрику ORM, менеджер базы данных,
а также генератор команд с поддержкой событий. Если ORM уже инициализирован,
то возвращает ранее созданный объект.
Генерация ORM основывается на схеме, созданной методом {@see compileSchema()},
которой, в свою очередь, необходим зарегистрированный реестр сущностей.
Управление базой данных осуществляется через метод {@see generateManager()}.

**Возвращаемый тип:** `int` - Количество записей в репозитории, связанных с данной сущностью.

**Теги:**
## Функция: `generateManager`

**Описание:**  
Создает и возвращает экземпляр класса DatabaseManager.
Если объект `orm_manager` еще не создан, метод инициирует новый объект
`DatabaseManager` на основе конфигурации ORM, полученной из метода `generateOrmConfig`.

**Возвращаемый тип:** `int` - Количество записей в репозитории, связанных с данной сущностью.

**Теги:**
## Функция: `generateOrmConfig`

**Описание:**  
Генерирует и возвращает объект конфигурации базы данных ORM, если он ещё не создан.
Функция проверяет, был ли ранее инициализирован объект конфигурации ORM.
Если объект отсутствует, производится его создание на основании глобальных настроек.
Подключается файл конфигурации базы данных и выполняется подготовка данных,
таких как разбиение хоста и порта, а также выборка префикса таблиц в зависимости от типа базы данных.

**Возвращаемый тип:** `int` - Количество записей в репозитории, связанных с данной сущностью.

**Теги:**
## Функция: `compileSchema`

**Описание:**  
Генерирует и компилирует схему на основе переданного реестра и генераторов схем.
Этот метод обрабатывает пути моделей с использованием глобального объекта `\$MIGRATOR`,
находит классы и использует их для генерации комплексной схемы базы данных.
Примечание: Метод использует глобальную переменную `\$MIGRATOR`, поэтому убедитесь,
что она правильно инициализирована до вызова метода.

**Возвращаемый тип:** `int` - Количество записей в репозитории, связанных с данной сущностью.

**Теги:**
## Функция: `setManager`

**Описание:**  
Устанавливает экземпляр EntityManager на основе текущего ORM.
Метод инициализирует объект EntityManager (менеджера для управления сущностями)
на основе существующего объекта ORM (Object-Relational Mapping).
Если ORM не был предварительно сконфигурирован, это может привести к выбросу ошибок
в процессе создания EntityManager.

**Возвращаемый тип:** `int` - Количество записей в репозитории, связанных с данной сущностью.

**Теги:**
## Функция: `delete`

**Описание:**  
Удаляет сущность на основе переданного объекта и первичного ключа.
Эта функция выполняет следующие шаги:
1. Извлекает объект сущности из базы данных с помощью метода `get`.
2. Передает этот объект менеджеру сущностей для удаления.
3. Выполняет транзакцию удаления.

**Возвращаемый тип:** `int` - Количество записей в репозитории, связанных с данной сущностью.

**Теги:**
## Функция: `get`

**Описание:**  
Получает сущность из хранилища данных по её первичному ключу.

**Возвращаемый тип:** `int` - Количество записей в репозитории, связанных с данной сущностью.

**Теги:**
## Функция: `getAll`

**Описание:**  
Получает все записи для указанной сущности из хранилища.
Этот метод использует репозиторий, ассоциированный с указанной сущностью,
для получения всех записей из базы данных.

**Возвращаемый тип:** `int` - Количество записей в репозитории, связанных с данной сущностью.

**Теги:**
## Функция: `repository`

**Описание:**  
Возвращает репозиторий для указанной сущности или класса сущности.
Эта функция принимает объект сущности или строку, представляющую имя класса сущности,
определяет их имя класса и возвращает соответствующий репозиторий, используя ORM.

**Возвращаемый тип:** `int` - Количество записей в репозитории, связанных с данной сущностью.

**Теги:**
## Функция: `getOrm`

**Описание:**  
Возвращает экземпляр ORM, создавая его при необходимости.
Данный метод вызывает `generateOrm`, который инициализирует ORM,
используя настраиваемые зависимости, такие как Schema, Factory, Container и CommandGenerator.
Повторные вызовы возвращают уже созданный экземпляр ORM.

**Возвращаемый тип:** `int` - Количество записей в репозитории, связанных с данной сущностью.

**Теги:**
## Функция: `run`

**Описание:**  
Выполняет сохранение сущности и возвращает состояние транзакции.
Этот метод обрабатывает сохранение переданного объекта сущности с использованием
связанного `EntityManager`. Завершает операцию методом `run()`, который выполняет
транзакцию и возвращает её результирующее состояние.

**Возвращаемый тип:** `int` - Количество записей в репозитории, связанных с данной сущностью.

**Теги:**
## Функция: `create`

**Описание:**  
Обновляет предоставленную сущность в базе данных.
Эта функция выполняет процесс обновления сущности посредством вызова метода `run`,
который предполагает выполнение различных ORM-операций, таких как `persist`.

**Возвращаемый тип:** `int` - Количество записей в репозитории, связанных с данной сущностью.

**Теги:**
## Функция: `update`

**Описание:**  
Обновляет предоставленную сущность в базе данных.
Эта функция выполняет процесс обновления сущности посредством вызова метода `run`,
который предполагает выполнение различных ORM-операций, таких, как `persist`.

**Возвращаемый тип:** `int` - Количество записей в репозитории, связанных с данной сущностью.

**Теги:**
## Функция: `query`

**Описание:**  
Выполняет SQL-запрос с указанными параметрами и возвращает результат.
Метод использует объект DatabaseManager для получения соединения с базой данных
и дальнейшего выполнения SQL-запроса. Позволяет передавать параметры для безопасного
выполнения подготовленных запросов.

**Возвращаемый тип:** `int` - Количество записей в репозитории, связанных с данной сущностью.

**Теги:**
## Функция: `paginate`

**Описание:**  
Пагинирует данные из базы данных для указанной сущности.
Этот метод извлекает данные для заданной сущности, применяет сортировку и пагинацию
на основе переданных параметров и возвращает настроенный объект `ORM\Select`.

**Возвращаемый тип:** `int` - Количество записей в репозитории, связанных с данной сущностью.

**Теги:**
## Функция: `count`

**Описание:**  
Подсчитывает количество записей для указанной сущности.
Эта функция использует репозиторий, связанный с сущностью, для выполнения запроса
на подсчет количества записей.

**Возвращаемый тип:** `int` - Количество записей в репозитории, связанных с данной сущностью.

**Теги:**
