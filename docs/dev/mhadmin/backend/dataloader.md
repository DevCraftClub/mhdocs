***

# DataLoader

Сборник функций для работы с базой данных и на самом сервере

## Метод подключения

```php
include_once DLEPlugins::Check(ENGINE_DIR . '/inc/maharder/_includes/trait/DataLoader.php');
```

## Свойства

### db

Класс для работы с базой данных, используемый системой DLE. Может быть пустым значением.

```php
protected static ?db $db
```

* **Статичное** свойство.

***

### prefix

Префикс таблиц базы данных DLE

```php
private ?string $prefix
```

***

### cache_folder

Папка кеша

```php
private string $cache_folder
```

***

## Методы

### connect

Функция подключения к базе данных

```php
public static connect(): void
```

* **Статичный** метод.

***

### getDb

Возвращает текущее подключение

```php
public static getDb(): db
```

* **Статичный** метод.

***

### setDb

Устанавливает подключение к базе данных

```php
public static setDb(db|null $db): void
```

* **Статичный** метод.

**Параметры:**

| Параметр | Тип | Описание                                                 |
|-----------|------|----------------------------------------------------------|
| `$db` | **db&#124;null** | Активное подключение класса к базе данных, либо пустое значение |

***

### getCacheFolder

Возвращает папку с кешем

```php
public getCacheFolder(): string
```

***

### setCacheFolder

Устанавливает папку с кешем

```php
public setCacheFolder(string $cache_folder): void
```

**Параметры:**

| Параметр | Тип | Описание          |
|-----------|------|-------------------|
| `$cache_folder` | **string** | Путь до папки с кешем |

***

### load_data

Функция создания кеша запросов,<br>
чтобы сократить кол-во обращений к базе данных

```php
public load_data(string $name, array $_vars): array
```

**Параметры:**

| Параметр | Тип | Описание                                                               |
|-----------|------|------------------------------------------------------------------------|
| `$name` | **string** | Переменная для названия кеша                                           |
| `$_vars` | **array** | Параметры для выборки данных из базы данных (Описание параметров ниже) |

**Параметры $_vars**:

| Параметр | Тип   | Описание                                                                                                                                                                                                                                 |
|----------|-------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|table| **string** | Название таблицы без префикса<br>*Прописывается в названии файла кеша*|
|sql| **string** | Запрос полностью, если он заполнен, то будет испольняться именно он, другие значения игнорируются                                                                                                                                        |
|where| **array** | Массив выборки запроса, прописывается в название файла кеша. <br>Заполняется так: 'поле' => 'значение', 'news_id' => '1'<br>*Прописывается в названии файла кеша*|
|selects| **array** | Массив вывод значений, если он пуст, то будут возвращены все значения таблицы.<br>Заполняется так: ['Ячейка 1', 'Ячейка 2', ...]<br>*Прописывается в названии файла кеша*                                                                |
|order| **array** | Массив сортировки вывода, прописывается в название файла кеша Заполняется так: 'поле' => 'Порядок сортировки', 'news_id' => 'ASC'<br>*Прописывается в названии файла кеша*|
|limit| **int&#124;string**| Ограничение вывода запросов, возможно указывать следующие значения:<br>*n    ->    просто максимальное кол-во данных*<br>*n,x  -> ограничение вывода, n - с какого захода начать сбор данных, x - до какого значения делать сбор данных*<br>*Прописывается в названии файла кеша*|

***

### dirToArray

Возвращает указанный путь в виде массива со всеми папками и файлами в нём

```php
protected static dirToArray(string $dir, array $except): array
```

* **Статичный** метод.

**Параметры:**

| Параметр | Тип        | Описание |
|-----------|------------|-------------|
| `$dir` | **string** | //  Путь, который нужно просканировать |
| `$except` | **array**      | //  Файл или файлы в массиве, которые нужно исключить из массива |

***

### clear_cache

Очищаем кеш, как системный, так и админпанели и запросов функции load_data

```php
public clear_cache(string $type = "all"): void
```

**Параметры:**

| Параметр | Тип | Описание                                                               |
|-----------|------|------------------------------------------------------------------------|
| `$type` | **string** | Тип кеша, либо all для всего кеша, либо наувание модели или приложения |


***

### get_cache

Получаем кеш

```php
public get_cache(string $type, string $name): array|false|int|mixed
```

**Параметры:**

| Параметр | Тип        | Описание                      |
|-----------|------------|-------------------------------|
| `$type` | **string** | Названия приложения / плагина |
| `$name` | **string**      | Название файла кеша  |

***

### set_cache

Сохраняем данные в кеш в формате json

```php
private set_cache(string $type, string $name, string $data): void
```

**Параметры:**

| Параметр | Тип              | Описание                      |
|-----------|------------------|-------------------------------|
| `$type` | **string**       | Названия приложения / плагина |
| `$name` | **string**       | Название файла кеша           |
| `$data` | **array&#124;int** | Данные кеша  |

***

### createDir

Создаёт папку по указанному пути

```php
protected static createDir(string $_path): bool
```

* **Статичный** метод.

**Параметры:**

| Параметр | Тип | Описание |
|-----------|------|-------------|
| `$_path` | **string** | Может содержать несколько путей, коротые будут объеденены в один |

***

### nameArgs

Преобразует ... аргументы в понятный массив

```php
public static nameArgs(array|null $args): array
```

* **Статичный** метод.

**Параметры:**

| Параметр | Тип | Описание   |
|-----------|------|------------|
| `$args` | **array&#124;null** | Массив с данными |

***

### defТип

Проверяет файл на верный тип и конвертирует его

```php
protected static defType( mixed $value, string $type): bool|float|int|string
```

* **Статичный** метод.


**Параметры:**

| Параметр | Тип       | Описание |
|-----------|-----------|-------------|
| `$value` | **mixed** | Значение |
| `$type` | **string**     | Проверяемый тип файла |

***

### getComparer

Обрабатывает значение на сверяющие знаки и возвращает в нужном параметре обратно

```php
protected static getComparer(string $value): string
```

* **Статичный** метод.

**Параметры:**

| Параметр | Тип   | Описание |
|-----------|-------|-------------|
| `$value` | **string** | Значение со знаками сравнения в начале |

| Первый знак | Описание                                                                                          |
|----------|---------------------------------------------------------------------------------------------------|
| !        | Отрицатильное значение. Превращает ! в <>                                                         |
| <(=)     | Больше (или равно). Превращает знак в < или <=                                                    |
| >(=)     | Меньше (или равно). Превращает знак в > или >=                                                    |
| (!)%     | Выражение (NOT) LIKE. Превращает знак в (NOT) LIKE и значение обрамляется % (к примеру: %value%) |


***

### getConfig

Получаем настройки модуля, если такие имеются.

```php
public getConfig(string $codename, string $path = ENGINE_DIR . '/inc/maharder/_config', string $confName = ''): array
```

Возвращает массив данных.

**Параметры:**

| Параметр | Тип | Описание                                                                                           |
|-----------|------|----------------------------------------------------------------------------------------------------|
| `$codename` | **string** | Название модуля, а так-же название конфигурации; без обозначений                                   |
| `$path` | **string** | Путь до конфигурации файла                                                                         |
| `$confName` | **string** | Если сохранилась конфигурация в папке /engine/data/, то указать название массива<br />без знака \$ |

***

### getPrefix

Возвращает префикс для таблиц

```php
public getPrefix(): string
```

***

### setPrefix

Устанавливает префикс таблиц

Указывается название таблицы, либо без указания. В случае пустого значения будет использоваться присвоенное `PREFIX` значение. В противном случае будет идти сверка с таблицами для пользователей и тогда значение будет равным к `USERPREFIX`.

```php
public setPrefix(?string $name = null): void
```

**Параметры:**

| Параметр | Тип | Описание               |
|-----------|------|------------------------|
| `$name` | **?string** | Название таблицы без префикса |

***


